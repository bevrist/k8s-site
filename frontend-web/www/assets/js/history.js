// //FIXME remove
var userData = {"FirstName":"Brett","LastName":"Evrist","Weight":115,"WaistCirc":30.5,"HeightInches":75,"LeanBodyMass":15,"Age":20,"StartDate":"2020-10-01","Gender":"male","Week":[{"Day":[{"Fat":10,"Carbs":10,"Protein":10,"TotalCalories":30,"DayCalories":"normal","Weight":123,"Cardio":"missed","WeightTraining":"yes"},{"Fat":20,"Carbs":20,"Protein":20,"TotalCalories":32,"DayCalories":"normal","Weight":123,"Cardio":"missed","WeightTraining":"no"},{"Fat":30,"Carbs":30,"Protein":30,"TotalCalories":33,"DayCalories":"high","Weight":123,"Cardio":"missed","WeightTraining":"yes"},{"Fat":40,"Carbs":40,"Protein":40,"TotalCalories":34,"DayCalories":"low","Weight":123,"Cardio":"hit","WeightTraining":"no"},{"Fat":10,"Carbs":10,"Protein":10,"TotalCalories":30,"DayCalories":"normal","Weight":123,"Cardio":"missed","WeightTraining":"yes"},{},{"Fat":100,"Carbs":100,"Protein":100,"TotalCalories":300,"DayCalories":"normal","Weight":321,"Cardio":"missed","WeightTraining":"no"}]},{"Day":[{"Fat":11,"Carbs":11,"Protein":11,"TotalCalories":31,"DayCalories":"normal","Weight":222,"Cardio":"missed","WeightTraining":"yes"},{"Fat":10,"Carbs":10,"Protein":10,"TotalCalories":30,"DayCalories":"low","Weight":123,"Cardio":"hit","WeightTraining":"no"},{"Fat":11,"Carbs":11,"Protein":11,"TotalCalories":31,"DayCalories":"normal","Weight":222,"Cardio":"missed","WeightTraining":"yes"},{"Fat":10,"Carbs":10,"Protein":10,"TotalCalories":30,"DayCalories":"low","Weight":123,"Cardio":"hit","WeightTraining":"no"},{"Fat":11,"Carbs":11,"Protein":11,"TotalCalories":31,"DayCalories":"normal","Weight":222,"Cardio":"missed","WeightTraining":"yes"},{"Fat":10,"Carbs":10,"Protein":10,"TotalCalories":30,"DayCalories":"low","Weight":123,"Cardio":"hit","WeightTraining":"no"},{"Fat":11,"Carbs":11,"Protein":11,"TotalCalories":31,"DayCalories":"normal","Weight":222,"Cardio":"missed","WeightTraining":"yes"}]},{"Day":[{"Fat":110,"Carbs":110,"Protein":110,"TotalCalories":310,"DayCalories":"high","Weight":123,"Cardio":"hit","WeightTraining":"no"},{"Fat":10,"Carbs":10,"Protein":10,"TotalCalories":30,"DayCalories":"normal","Weight":123,"Cardio":"missed","WeightTraining":"yes"},{},{"Fat":10,"Carbs":10,"Protein":10,"TotalCalories":30,"DayCalories":"normal","Weight":123,"Cardio":"missed","WeightTraining":"yes"},{"Fat":110,"Carbs":110,"Protein":110,"TotalCalories":310,"DayCalories":"high","Weight":123,"Cardio":"hit","WeightTraining":"no"},{"Fat":10,"Carbs":10,"Protein":10,"TotalCalories":30,"DayCalories":"normal","Weight":123,"Cardio":"missed","WeightTraining":"yes"},{"Fat":110,"Carbs":110,"Protein":110,"TotalCalories":310,"DayCalories":"high","Weight":123,"Cardio":"hit","WeightTraining":"no"}]},{"Day":[{"Fat":11,"Carbs":11,"Protein":11,"TotalCalories":31,"DayCalories":"normal","Weight":222,"Cardio":"missed","WeightTraining":"yes"},{"Fat":10,"Carbs":10,"Protein":10,"TotalCalories":30,"DayCalories":"low","Weight":123,"Cardio":"hit","WeightTraining":"no"},{"Fat":11,"Carbs":11,"Protein":11,"TotalCalories":31,"DayCalories":"normal","Weight":222,"Cardio":"missed","WeightTraining":"yes"},{"Fat":10,"Carbs":10,"Protein":10,"TotalCalories":30,"DayCalories":"low","Weight":123,"Cardio":"hit","WeightTraining":"no"},{"Fat":11,"Carbs":11,"Protein":11,"TotalCalories":31,"DayCalories":"normal","Weight":222,"Cardio":"missed","WeightTraining":"yes"},{"Fat":10,"Carbs":10,"Protein":10,"TotalCalories":30,"DayCalories":"low","Weight":123,"Cardio":"hit","WeightTraining":"no"},{"Fat":11,"Carbs":11,"Protein":11,"TotalCalories":31,"DayCalories":"normal","Weight":222,"Cardio":"missed","WeightTraining":"yes"}]},{"Day":[{"Fat":110,"Carbs":110,"Protein":110,"TotalCalories":310,"DayCalories":"high","Weight":123,"Cardio":"hit","WeightTraining":"no"},{"Fat":10,"Carbs":10,"Protein":10,"TotalCalories":30,"DayCalories":"normal","Weight":123,"Cardio":"missed","WeightTraining":"yes"},{"Fat":110,"Carbs":110,"Protein":110,"TotalCalories":310,"DayCalories":"high","Weight":123,"Cardio":"hit","WeightTraining":"no"},{"Fat":10,"Carbs":10,"Protein":10,"TotalCalories":30,"DayCalories":"normal","Weight":123,"Cardio":"missed","WeightTraining":"yes"},{"Fat":110,"Carbs":110,"Protein":110,"TotalCalories":310,"DayCalories":"high","Weight":123,"Cardio":"hit","WeightTraining":"no"},{"Fat":10,"Carbs":10,"Protein":10,"TotalCalories":30,"DayCalories":"normal","Weight":123,"Cardio":"missed","WeightTraining":"yes"},{"Fat":110,"Carbs":110,"Protein":110,"TotalCalories":310,"DayCalories":"high","Weight":123,"Cardio":"hit","WeightTraining":"no"}]},{"Day":[{},{"Fat":10,"Carbs":10,"Protein":10,"TotalCalories":30,"DayCalories":"low","Weight":123,"Cardio":"hit","WeightTraining":"no"},{},{"Fat":10,"Carbs":10,"Protein":10,"TotalCalories":30,"DayCalories":"low","Weight":123,"Cardio":"hit","WeightTraining":"no"},{"Fat":11,"Carbs":11,"Protein":11,"TotalCalories":31,"DayCalories":"normal","Weight":222,"Cardio":"missed","WeightTraining":"yes"},{"Fat":10,"Carbs":10,"Protein":10,"TotalCalories":30,"DayCalories":"low","Weight":123,"Cardio":"hit","WeightTraining":"no"},{"Fat":11,"Carbs":11,"Protein":11,"TotalCalories":31,"DayCalories":"normal","Weight":222,"Cardio":"missed","WeightTraining":"yes"}]},{"Day":[{"Fat":110,"Carbs":110,"Protein":110,"TotalCalories":310,"DayCalories":"high","Weight":123,"Cardio":"hit","WeightTraining":"no"},{"Fat":10,"Carbs":10,"Protein":10,"TotalCalories":30,"DayCalories":"normal","Weight":123,"Cardio":"missed","WeightTraining":"yes"},{"Fat":110,"Carbs":110,"Protein":110,"TotalCalories":310,"DayCalories":"high","Weight":123,"Cardio":"hit","WeightTraining":"no"},{"Fat":10,"Carbs":10,"Protein":10,"TotalCalories":30,"DayCalories":"normal","Weight":123,"Cardio":"missed","WeightTraining":"yes"},{"Fat":110,"Carbs":110,"Protein":110,"TotalCalories":310,"DayCalories":"high","Weight":123,"Cardio":"hit","WeightTraining":"no"},{"Fat":10,"Carbs":10,"Protein":10,"TotalCalories":30,"DayCalories":"normal","Weight":123,"Cardio":"missed","WeightTraining":"yes"},{"Fat":110,"Carbs":110,"Protein":110,"TotalCalories":310,"DayCalories":"high","Weight":123,"Cardio":"hit","WeightTraining":"no"}]},{"Day":[{"Fat":11,"Carbs":11,"Protein":11,"TotalCalories":31,"DayCalories":"normal","Weight":222,"Cardio":"missed","WeightTraining":"yes"},{"Fat":10,"Carbs":10,"Protein":10,"TotalCalories":30,"DayCalories":"low","Weight":123,"Cardio":"hit","WeightTraining":"no"},{"Fat":11,"Carbs":11,"Protein":11,"TotalCalories":31,"DayCalories":"normal","Weight":222,"Cardio":"missed","WeightTraining":"yes"},{"Fat":10,"Carbs":10,"Protein":10,"TotalCalories":30,"DayCalories":"low","Weight":123,"Cardio":"hit","WeightTraining":"no"},{"Fat":11,"Carbs":11,"Protein":11,"TotalCalories":31,"DayCalories":"normal","Weight":222,"Cardio":"missed","WeightTraining":"yes"},{"Fat":10,"Carbs":10,"Protein":10,"TotalCalories":30,"DayCalories":"low","Weight":123,"Cardio":"hit","WeightTraining":"no"},{"Fat":11,"Carbs":11,"Protein":11,"TotalCalories":31,"DayCalories":"normal","Weight":222,"Cardio":"missed","WeightTraining":"yes"}]},{"Day":[{"Fat":110,"Carbs":110,"Protein":110,"TotalCalories":310,"DayCalories":"high","Weight":123,"Cardio":"hit","WeightTraining":"no"},{"Fat":10,"Carbs":10,"Protein":10,"TotalCalories":30,"DayCalories":"normal","Weight":123,"Cardio":"missed","WeightTraining":"yes"},{"Fat":110,"Carbs":110,"Protein":110,"TotalCalories":310,"DayCalories":"high","Weight":123,"Cardio":"hit","WeightTraining":"no"},{"Fat":10,"Carbs":10,"Protein":10,"TotalCalories":30,"DayCalories":"normal","Weight":123,"Cardio":"missed","WeightTraining":"yes"},{"Fat":110,"Carbs":110,"Protein":110,"TotalCalories":310,"DayCalories":"high","Weight":123,"Cardio":"hit","WeightTraining":"no"},{"Fat":10,"Carbs":10,"Protein":10,"TotalCalories":30,"DayCalories":"normal","Weight":123,"Cardio":"missed","WeightTraining":"yes"},{"Fat":110,"Carbs":110,"Protein":110,"TotalCalories":310,"DayCalories":"high","Weight":123,"Cardio":"hit","WeightTraining":"no"}]},{"Day":[{"Fat":11,"Carbs":11,"Protein":11,"TotalCalories":31,"DayCalories":"normal","Weight":222,"Cardio":"missed","WeightTraining":"yes"},{"Fat":10,"Carbs":10,"Protein":10,"TotalCalories":30,"DayCalories":"low","Weight":123,"Cardio":"hit","WeightTraining":"no"},{"Fat":11,"Carbs":11,"Protein":11,"TotalCalories":31,"DayCalories":"normal","Weight":222,"Cardio":"missed","WeightTraining":"yes"},{"Fat":10,"Carbs":10,"Protein":10,"TotalCalories":30,"DayCalories":"low","Weight":123,"Cardio":"hit","WeightTraining":"no"},{"Fat":11,"Carbs":11,"Protein":11,"TotalCalories":31,"DayCalories":"normal","Weight":222,"Cardio":"missed","WeightTraining":"yes"},{"Fat":10,"Carbs":10,"Protein":10,"TotalCalories":30,"DayCalories":"low","Weight":123,"Cardio":"hit","WeightTraining":"no"},{"Fat":11,"Carbs":11,"Protein":11,"TotalCalories":31,"DayCalories":"normal","Weight":222,"Cardio":"missed","WeightTraining":"yes"}]},{"Day":[{"Fat":110,"Carbs":110,"Protein":110,"TotalCalories":310,"DayCalories":"high","Weight":123,"Cardio":"hit","WeightTraining":"no"},{"Fat":10,"Carbs":10,"Protein":10,"TotalCalories":30,"DayCalories":"normal","Weight":123,"Cardio":"missed","WeightTraining":"yes"},{"Fat":110,"Carbs":110,"Protein":110,"TotalCalories":310,"DayCalories":"high","Weight":123,"Cardio":"hit","WeightTraining":"no"},{"Fat":10,"Carbs":10,"Protein":10,"TotalCalories":30,"DayCalories":"normal","Weight":123,"Cardio":"missed","WeightTraining":"yes"},{"Fat":110,"Carbs":110,"Protein":110,"TotalCalories":310,"DayCalories":"high","Weight":123,"Cardio":"hit","WeightTraining":"no"},{"Fat":10,"Carbs":10,"Protein":10,"TotalCalories":30,"DayCalories":"normal","Weight":123,"Cardio":"missed","WeightTraining":"yes"},{"Fat":110,"Carbs":110,"Protein":110,"TotalCalories":310,"DayCalories":"high","Weight":123,"Cardio":"hit","WeightTraining":"no"}]},{"Day":[{},{},{},{},{},{},{}]},{"Day":[{},{},{},{},{},{},{}]},{"Day":[{},{},{},{},{},{},{}]},{"Day":[{},{},{},{},{},{},{}]},{"Day":[{},{},{},{},{},{},{}]},{"Day":[{},{},{},{},{},{},{}]},{"Day":[{},{},{},{},{},{},{}]},{"Day":[{},{},{},{},{},{},{}]},{"Day":[{},{},{},{},{},{},{}]},{"Day":[{},{},{},{},{},{},{}]},{"Day":[{},{},{},{},{},{},{}]},{"Day":[{},{},{},{},{},{},{}]},{"Day":[{},{},{},{},{},{},{}]}],"Recommendation":[{"HighDayProtein":10,"HighDayCarb":11,"HighDayFat":12,"HighDayCalories":13,"NormalDayProtein":14,"NormalDayCarb":15,"NormalDayFat":16,"NormalDayCalories":17,"LowDayProtein":18,"LowDayCarb":19,"LowDayFat":20,"LowDayCalories":21,"HIITCurrentCardioSession":22,"HIITChangeCardioSession":23,"HIITCurrentCardioIntervals":24,"HIITChangeCardioIntervals":25,"ModifiedDate":"2020-09-13"},{},{},{"HighDayProtein":22,"HighDayCarb":12,"HighDayFat":12,"HighDayCalories":12,"NormalDayProtein":12,"NormalDayCarb":12,"NormalDayFat":12,"NormalDayCalories":12,"LowDayProtein":12,"LowDayCarb":12,"LowDayFat":22,"LowDayCalories":22,"HIITCurrentCardioSession":22,"HIITChangeCardioSession":22,"HIITCurrentCardioIntervals":22,"HIITChangeCardioIntervals":22,"ModifiedDate":"2020-09-16"},{"HighDayProtein":23,"HighDayCarb":13,"HighDayFat":13,"HighDayCalories":13,"NormalDayProtein":13,"NormalDayCarb":13,"NormalDayFat":13,"NormalDayCalories":13,"LowDayProtein":13,"LowDayCarb":13,"LowDayFat":23,"LowDayCalories":23,"HIITCurrentCardioSession":23,"HIITChangeCardioSession":23,"HIITCurrentCardioIntervals":23,"HIITChangeCardioIntervals":23,"ModifiedDate":"2020-09-16"},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{}]}
// //FIXME REMOVE
document.cookie = "Session-Token=test; SameSite=Strict;";  //FIXME REMOVE

//FIXME update this
// //get user data from api and store JSON in "userData"
// var xmlHttp = new XMLHttpRequest();
// xmlHttp.open( "GET", "http://localhost:8888/userInfo", false );
// xmlHttp.setRequestHeader("Session-Token","test2"); //FIXME use correct session-token
// xmlHttp.send(null);
// var userData = JSON.parse(xmlHttp.responseText);






//link to current week
var currentWeekLink = "#";

// populate starting date
var startDate = new Date(userData.StartDate);
document.getElementById("StartDate").value = startDate.toISOString().split('T')[0];
document.getElementById("Form-Session-Token-StartDate").value = getCookie("Session-Token");

//helper function for adding days to date
Date.prototype.addDays = function (days) {
  var date = new Date(this.valueOf());
  date.setDate(date.getDate() + days);
  return date;
}

// this function clones a unique form and renames items in form
function cloneForm(weekNum) {
  var myDiv = document.getElementById("myContainer");
  var divClone = myDiv.cloneNode(true);

  // document.getElementById("formWeek-0").action = "http://localhost:8080/userWeeklyTracking/" + weekNum;
  document.getElementById("formWeek-0").id = "formWeek-" + weekNum;
  document.getElementById("formLink-0").name = "formLink-" + weekNum;
  document.getElementById("formLink-0").id = "formLink-" + weekNum;
  document.getElementById("weekHeading-0").innerHTML = "Week " + weekNum;
  document.getElementById("weekHeading-0").id = "weekHeading-" + weekNum;
  document.getElementById("formSaveButton-0").innerHTML = "Save Week " + weekNum;
  document.getElementById("formSaveButton-0").id = "formSaveButton-" + weekNum;
  document.getElementById("Form-Session-Token-0").value = getCookie("Session-Token");
  document.getElementById("Form-Session-Token-0").id = "Form-Session-Token-" + weekNum;
  document.getElementById("myContainer").id = "week" + weekNum;
  document.body.appendChild(divClone);


  makeWeekChart(weekNum, 0);
  makeWeekChart(weekNum, 1);
  makeWeekChart(weekNum, 2);
  makeWeekChart(weekNum, 3);
  makeWeekChart(weekNum, 4);
  makeWeekChart(weekNum, 5);
  makeWeekChart(weekNum, 6);
  makeWeekChart(null, null);
}

var dayOffset = 1;
function makeWeekChart(weekNum, dayNum) {
  //if weekNum is null: remove last tableRow, return
  if (weekNum == null) {
    document.getElementById("tableRow").remove();
    // jump to particular location on page
    setTimeout(function () { location.href = currentWeekLink; }, 1000);
    return;
  }
  weekNum = weekNum - 1;
  var myDiv2 = document.getElementById("tableRow");
  var divClone2 = myDiv2.cloneNode(true);
  //populate existing week row with data and remove id's
  // calculate date for row
  var currDate = startDate.addDays(dayOffset++);
  document.getElementById("date").childNodes[0].innerHTML = currDate.getMonth() + 1 + "/" + currDate.getDate();
  document.getElementById("date").removeAttribute("id");
  //check if date is current date, set link to jump down to week on page completion
  var todayDate = new Date();
  if (currDate.toISOString().split('T')[0] == todayDate.toISOString().split('T')[0]) {
    currentWeekLink = "#formLink-" + (weekNum + 1);
  }
  //TODO: training //check for and store week of current date
  //day calories
  switch (userData.Week[weekNum].Day[dayNum].DayCalories) {
    case "normal":
      document.getElementById("dayNorm").selected = "selected"
      break;
    case "low":
      document.getElementById("dayLow").selected = "selected"
      break;
    case "high":
      document.getElementById("dayHigh").selected = "selected"
      break;
  }
  document.getElementById("dayNorm").removeAttribute("id");
  document.getElementById("dayLow").removeAttribute("id");
  document.getElementById("dayHigh").removeAttribute("id");

  //cardio
  switch (userData.Week[weekNum].Day[dayNum].Cardio) {
    case "none":
      document.getElementById("cardioNone").selected = "selected"
      break;
    case "missed":
      document.getElementById("cardioMiss").selected = "selected"
      break;
    case "hit":
      document.getElementById("cardioHit").selected = "selected"
      break;
  }
  document.getElementById("cardioNone").removeAttribute("id");
  document.getElementById("cardioMiss").removeAttribute("id");
  document.getElementById("cardioHit").removeAttribute("id");

  //weight training
  switch (userData.Week[weekNum].Day[dayNum].WeightTraining) {
    case "yes":
      document.getElementById("trainingYes").selected = "selected"
      break;
    case "no":
      document.getElementById("trainingNo").selected = "selected"
      break;
  }
  document.getElementById("trainingNo").removeAttribute("id");
  document.getElementById("trainingYes").removeAttribute("id");

  document.getElementById("fat").value = userData.Week[weekNum].Day[dayNum].Fat;
  document.getElementById("fat").removeAttribute("id");
  document.getElementById("carbs").value = userData.Week[weekNum].Day[dayNum].Carbs;
  document.getElementById("carbs").removeAttribute("id");
  document.getElementById("protein").value = userData.Week[weekNum].Day[dayNum].Protein;
  document.getElementById("protein").removeAttribute("id");
  document.getElementById("calories").value = userData.Week[weekNum].Day[dayNum].TotalCalories;
  document.getElementById("calories").removeAttribute("id");
  document.getElementById("weight").value = userData.Week[weekNum].Day[dayNum].Weight;
  document.getElementById("weight").removeAttribute("id");
  //clone table row
  document.getElementById("tableRow").id = "tableRowNext";
  document.getElementById("tableRowNext").parentElement.appendChild(divClone2);
  document.getElementById("tableRowNext").removeAttribute("id");
}

//clone through week 24
for (var i = 1; i <= userData.Week.length; i++) {
  cloneForm(i);
}
document.getElementById("myContainer").remove(); // delete empty clone form at end

// //get UserProfile json object, call other functions on complete
// fetch("http://localhost:8080/userWeeklyTracking/" + num, {
//   headers: {
//     'Session-Token': getCookie("Session-Token"),
//   }
// }).then(function (response) {
//   response.json().then(function (data) {
//     updateForm(data);
//   });
// });
