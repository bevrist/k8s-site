<!DOCTYPE html>
<html>

<head>
  <style>
    table {
      font-family: arial, sans-serif;
      border-collapse: collapse;
      width: 100%;
    }

    td,
    th {
      border: 1px solid #dddddd;
      text-align: left;
      padding: 8px;
    }

    #chart-title {
      background-color: #d62121e5;
      color: #ffffff;
    }

    tr:nth-child(odd) {
      background-color: #dddddd;
    }
  </style>
</head>

<body>
  <h2>Crap ui page</h2>

  <!-- Input Form -->
  <form action="/submitForm" method="POST">
    <label for="weight">Weight (lbs):</label><br>
    <input type="number" id="weight" name="weight" placeholder="150" required><br>
    <label for="height">Height (inches):</label><br>
    <input type="number" id="height" name="height" placeholder="71" required><br>
    <label for="waist">Waist cir. (inches):</label><br>
    <input type="number" id="waist" name="waist" placeholder="55">
    <input name="Session-Token" id="Form-Session-Token" type="hidden" value="nill">
    <br><br>
    <input type="submit" value="Submit">
  </form>

  <br><button onclick="signOut()">Sign Out</button>

  <!-- Output Chart -->
  <br><br>
  <table id="table">
    <tr id="chart-title">
      <th>High Day</th>
      <th></th>
      <th></th>
    </tr>
    <tr>
      <th>Macros</th>
      <th>Grams</th>
      <th>% Ratio</th>
    </tr>
    <tr>
      <td>Protein</td>
      <td id="a1">235</td>
      <td id="a2">38%</td>
    </tr>
    <tr>
      <td>Carbs</td>
      <td>234</td>
      <td>37%</td>
    </tr>
    <tr>
      <td>Fat</td>
      <td>69</td>
      <td>25%</td>
    </tr>
    <tr>
      <td>Calories</td>
      <td>2497</td>
      <td>100%</td>
    </tr>
  </table>
  <br>
  <!--TODO remove-->
  <button onclick="update()">Update</button>

  <!-- Debug show raw json response -->
  <p id="aa"></p>
</body>

</html>

<!-- firebase files -->
<script src="https://www.gstatic.com/firebasejs/7.15.5/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.15.5/firebase-analytics.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.15.5/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.15.5/firebase-firestore.js"></script>

<script>
  function update() { //<!--TODO edit with real data -->
    var tableRow = document.getElementById("table").insertRow();
    tableRow.insertCell(0).appendChild(document.createTextNode("aaaaaa"));
    tableRow.insertCell(1).appendChild(document.createTextNode("bbbbb"));
    tableRow.insertCell(2).appendChild(document.createTextNode("cccc"));
  }

  function requestUserData(session_token) {
    //update hidden form element
    document.getElementById("Form-Session-Token").value = session_token;

    //get json object of chart data
    fetch("http://localhost:8080/getUserData", {
      headers: {
        'Session-Token': session_token,
      }
    }).then(function (response) {
      response.json().then(function (data) {
        updateChart(data);
        // console.log(data)
        //<!--TODO redirect to profile page when FirstName == "" -->
        // window.location.replace('http://localhost:8080/profile');
      });
    });
  }

  function updateChart(data) {
    document.getElementById("a1").innerHTML = data.FirstName;
    document.getElementById("a2").innerHTML = data.Weight;
    document.getElementById("aa").innerHTML = JSON.stringify(data);
  }



  // Your web app's Firebase configuration
  var firebaseConfig = {
    apiKey: "AIzaSyBPjt5odWGOGfibWvV6R8KpXg06DovhoGc",
    authDomain: "workout-app-8b023.firebaseapp.com",
    databaseURL: "https://workout-app-8b023.firebaseio.com",
    projectId: "workout-app-8b023",
    storageBucket: "workout-app-8b023.appspot.com",
    messagingSenderId: "367406151070",
    appId: "1:367406151070:web:96633b967a09b3a5b3528f",
    measurementId: "G-V1Z7ZFZ3M2"
  };
  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  firebase.analytics();

  //check if user is logged in when user object updates
  firebase.auth().onAuthStateChanged(function (user) {
    if (user) {
      // User is signed in.
      console.log(user);
      console.log("User UID: " + user.uid);
      console.log("User Token: " + user._lat);
      requestUserData(user._lat);
    } else {
      // No user is signed in.
      console.log("not signed in");
      window.location.replace('http://localhost:8080/auth');
    }
  });

  function signOut() {
    firebase.auth().signOut().then(function () {
      // Sign-out successful.
    }).catch(function (error) {
      // An error happened.
    });
  }
</script>