
# ---
# apiVersion: apps/v1
# kind: Deployment
# metadata:
#   name: web-application-db
#   namespace: web
# spec:
#   selector:
#     matchLabels:
#       app: database
#   template:
#     metadata:
#       labels:
#         app: database

---
apiVersion: v1
kind: Pod
metadata:
  name: database
  namespace: web
spec:
  containers:
  - name: database
    image: mongodb-test
    env:
      - name: DATABASE_LISTEN_ADDRESS
        value: "0.0.0.0:8050"
      - name: DATABASE_ADDRESS
        value: "localhost:27017"
      - name: DATABASE_USERNAME
        value: adminz
      - name: DATABASE_PASSWORD
        value: cheeksbutt
    imagePullPolicy: IfNotPresent
    ports:
    - name: database-port
      containerPort: 27017
    resources:
      limits:
        cpu: "1000m"
        memory: "600Mi"
      requests:
        cpu: "400m"
        memory: "200Mi"

---
apiVersion: v1
kind: Pod
metadata:
  name: backend
  namespace: web
spec:
  containers:
  - name: backend
    image: backend
    env:
      - name: BACKEND_LISTEN_ADDRESS
        value: "0.0.0.0:8090"
      - name: DATABASE_ADDRESS
        value: "localhost:8050"
    imagePullPolicy: IfNotPresent
    ports:
    - name: backend-port
      containerPort: 8090
    resources:
      limits:
        cpu: "1000m"
        memory: "600Mi"
      requests:
        cpu: "400m"
        memory: "200Mi"

---

apiVersion: v1
kind: Pod
metadata:
  name: auth
  namespace: web
spec:
  containers:
  - name: auth
    image: auth
    env:
      - name: AUTH_LISTEN_ADDRESS
        value: "0.0.0.0:8070"
      - name: AUTH_FIREBASE_CREDENTIALS
        value: '{}'
    imagePullPolicy: IfNotPresent
    ports:
    - name: auth-port
      containerPort: 8070
    resources:
      limits:
        cpu: "1000m"
        memory: "600Mi"
      requests:
        cpu: "400m"
        memory: "200Mi"



---

apiVersion: v1
kind: Service
metadata:
  namespace: web
  name: database
spec:
  type: NodePort
  selector:
    app: database
  ports:
      # By default and for convenience, the `targetPort` is set to the same value as the `port` field.
    - port: 8070
      targetPort: 8070
      # Optional field
      # By default and for convenience, the Kubernetes control plane will allocate a port from a range (default: 30000-32767)
      nodePort: 30010